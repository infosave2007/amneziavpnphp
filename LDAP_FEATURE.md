# LDAP Integration - Feature Branch

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- ‚úÖ PHP LDAP —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤ Dockerfile
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (ldap_configs, user_roles, ldap_group_mappings)
- ‚úÖ –ö–ª–∞—Å—Å `LdapSync.php` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `Auth.php` - –∞–≤—Ç–æ-–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É LDAP/–ª–æ–∫–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ Cron –∑–∞–¥–∞—á–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω)
- ‚úÖ UI —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ LDAP (templates/settings/ldap.twig)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è LDAP_SETUP.md

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ LDAP/Active Directory
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–∞–ø–ø–∏–Ω–≥ LDAP –≥—Ä—É–ø–ø –Ω–∞ —Ä–æ–ª–∏ (admin/manager/viewer)
- –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ LDAP
- Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞

### –ö—Ä–∏—Ç–∏—á–Ω–æ–µ:
1. **–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã –≤ `public/index.php`:**
   ```php
   $router->add('GET', '/settings/ldap', [SettingsController::class, 'ldapSettings']);
   $router->add('POST', '/settings/ldap/save', [SettingsController::class, 'saveLdapSettings']);
   $router->add('POST', '/settings/ldap/test', [SettingsController::class, 'testLdapConnection']);
   ```

2. **–°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥—ã –≤ `controllers/SettingsController.php`:**
   - `ldapSettings()` - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
   - `saveLdapSettings()` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
   - `testLdapConnection()` - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

3. **–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã** –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ 002-006 (ru, en, es, de, fr, zh):
   - ldap_settings
   - enable_ldap_auth
   - test_connection
   - ldap_host / ldap_port / base_dn / bind_dn
   - sync_interval
   - ldap_group_mappings

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
- –õ–æ–≥–∏ LDAP –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
- –í–∞–ª–∏–¥–∞—Ü–∏—è LDAP –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ:
```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å LDAP —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
docker-compose build

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec web php -r "require 'inc/Config.php'; require 'inc/DB.php'; DB::runMigrations();"

# –¢–µ—Å—Ç LDAP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
docker-compose exec web php bin/sync_ldap_users.php
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/settings/ldap` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ LDAP (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π LDAP —Å–µ—Ä–≤–µ—Ä)

## üìã TODO –ø–µ—Ä–µ–¥ —Å–ª–∏—è–Ω–∏–µ–º –≤ master

- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º LDAP/AD —Å–µ—Ä–≤–µ—Ä–æ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (–±–µ–∑ LDAP –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å README.md —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ LDAP

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚ùå –ü–∞—Ä–æ–ª–∏ LDAP –Ω–µ —à–∏—Ñ—Ä—É—é—Ç—Å—è (TODO: –¥–æ–±–∞–≤–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î)
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è - –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ TLS/SSL –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è LDAP

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `LDAP_SETUP.md` –¥–ª—è:
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ AD/OpenLDAP
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä—É–ø–ø –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- Troubleshooting
- Best practices
