# Testing Panel Import Feature

## –í–µ—Ç–∫–∞: feature/panel-import

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

### 1. –ö–ª–∞—Å—Å PanelImporter (inc/PanelImporter.php)
- –ü–∞—Ä—Å–∏–Ω–≥ backup —Ñ–∞–π–ª–æ–≤ –æ—Ç wg-easy –∏ 3x-ui
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- –ò–º–ø–æ—Ä—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ –ë–î

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –ú–∏–≥—Ä–∞—Ü–∏—è 008_add_panel_imports.sql
- –¢–∞–±–ª–∏—Ü–∞ panel_imports (–∏—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤)
- –ü–æ–ª—è: server_id, panel_type, clients_imported, status, error_message

### 3. UI –∏–∑–º–µ–Ω–µ–Ω–∏—è
- templates/servers/create.twig: —Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ backup
- templates/servers/view.twig: —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∏–º–ø–æ—Ä—Ç–∞
- –ß–µ–∫–±–æ–∫—Å "Import from existing panel"
- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –ø–∞–Ω–µ–ª–∏ (wg-easy / 3x-ui)
- –ó–∞–≥—Ä—É–∑–∫–∞ JSON —Ñ–∞–π–ª–∞

### 4. API Endpoints
```
POST /api/servers/{id}/import
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: panel_type, backup_file (multipart)
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: success, import_id, imported_count, errors

GET /api/servers/{id}/imports
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–º–ø–æ—Ä—Ç–æ–≤ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
```

### 5. –ü–µ—Ä–µ–≤–æ–¥—ã
–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞ –≤—Å–µ—Ö 6 —è–∑—ã–∫–∞—Ö:
- servers.import_from_panel
- servers.select_panel_type
- servers.panel_type_wgeasy
- servers.panel_type_3xui
- servers.upload_backup_file
- servers.import_in_progress
- servers.import_success
- servers.import_failed
- servers.import_partial
- servers.import_history

### 6. –ü—Ä–∏–º–µ—Ä—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- examples/wg-easy-backup-example.json
- examples/3x-ui-backup-example.json
- examples/README.md (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–º–ø–æ—Ä—Ç—É)
- –û–±–Ω–æ–≤–ª–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–π README.md

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞–Ω–µ–ª—å:**
```bash
cd /Users/oleg/Documents/amnezia-web-panel
docker compose up -d
```

2. **–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É:**
- URL: http://localhost:8082
- Email: admin@amnez.ia
- Password: admin123

3. **–°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–µ—Ä —Å –∏–º–ø–æ—Ä—Ç–æ–º:**
- Servers ‚Üí Add Server
- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ SSH –¥–∞–Ω–Ω—ã–µ
- –û—Ç–º–µ—Ç—å—Ç–µ "Import from existing panel"
- –í—ã–±–µ—Ä–∏—Ç–µ "wg-easy" –∏–ª–∏ "3x-ui"
- –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ `examples/`
- –ù–∞–∂–º–∏—Ç–µ "Create Server"

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∏–º–ø–æ—Ä—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–µ—Ä–≤–µ—Ä–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ API

1. **–ü–æ–ª—É—á–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω:**
```bash
curl -X POST http://localhost:8082/api/auth/token \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@amnez.ia",
    "password": "admin123"
  }'
```

2. **–°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
```bash
TOKEN="your_jwt_token_here"

curl -X POST http://localhost:8082/api/servers/create \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Server",
    "host": "192.168.1.100",
    "port": 22,
    "username": "root",
    "password": "your_password"
  }'
```

3. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–æ–≤:**
```bash
SERVER_ID=1

curl -X POST http://localhost:8082/api/servers/$SERVER_ID/import \
  -H "Authorization: Bearer $TOKEN" \
  -F "panel_type=wg-easy" \
  -F "backup_file=@examples/wg-easy-backup-example.json"
```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –∏–º–ø–æ—Ä—Ç–∞:**
```bash
curl http://localhost:8082/api/servers/$SERVER_ID/imports \
  -H "Authorization: Bearer $TOKEN"
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î –Ω–∞–ø—Ä—è–º—É—é

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É panel_imports
docker compose exec db mysql -uamnezia -pamnezia amnezia_panel \
  -e "SELECT * FROM panel_imports"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
docker compose exec db mysql -uamnezia -pamnezia amnezia_panel \
  -e "SELECT id, name, client_ip, status FROM vpn_clients WHERE server_id=1"
```

## üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

### –ò–º–ø–æ—Ä—Ç –∏–∑ wg-easy:
- ‚úÖ –ö–ª–∏–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏ IP –∞–¥—Ä–µ—Å–∞–º–∏
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚úÖ Pre-shared –∫–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚úÖ –°—Ç–∞—Ç—É—Å enabled/disabled –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏

### –ò–º–ø–æ—Ä—Ç –∏–∑ 3x-ui:
- ‚úÖ –ö–ª–∏–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏ (–∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
- ‚úÖ IP –∞–¥—Ä–µ—Å–∞ –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è –∏–∑ –ø—É–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ Traffic limits —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è (totalGB ‚Üí bytes)
- ‚úÖ Expiration dates —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã)
- ‚úÖ –°—Ç–∞—Ç—É—Å enable/disable –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

### –û–±—â–µ–µ:
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ panel_imports
- ‚úÖ –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ error_message
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–µ—Ä–µ–≤–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö
- ‚úÖ UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–º–ø–æ—Ä—Ç–∞

## üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

1. **wg-easy**: –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π backup —Å –∫–ª—é—á–∞–º–∏
2. **3x-ui**: –ö–ª—é—á–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ (3x-ui –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Ö)
3. **–î—É–±–ª–∏–∫–∞—Ç—ã**: –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å —Ç–∞–∫–∏–º IP —É–∂–µ –µ—Å—Ç—å, –∏–º–ø–æ—Ä—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –µ–≥–æ
4. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ PHP (default: 2MB)

## üîÑ –°–ª–∏—è–Ω–∏–µ —Å master:

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
git checkout master
git merge feature/panel-import
git push origin master
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

- **–î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫:** +795
- **–£–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫:** -10
- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 15
- **–ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** 5 (PanelImporter.php, –º–∏–≥—Ä–∞—Ü–∏—è, 3 –ø—Ä–∏–º–µ—Ä–∞)

## üéØ –¶–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã:

‚úÖ –ò–º–ø–æ—Ä—Ç –∏–∑ wg-easy —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–ª—é—á–µ–π –∏ IP  
‚úÖ –ò–º–ø–æ—Ä—Ç –∏–∑ 3x-ui —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π  
‚úÖ UI –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ backup —Ñ–∞–π–ª–æ–≤  
‚úÖ API endpoints –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞  
‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ –ë–î  
‚úÖ –ü–µ—Ä–µ–≤–æ–¥—ã –Ω–∞ 6 —è–∑—ã–∫–æ–≤  
‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è  
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫  

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:

- [x] –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
- [x] UI —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] API —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ü–µ—Ä–µ–≤–æ–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [x] –ü—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ ‚Üê **–í–∞—à —à–∞–≥**
- [ ] –ö–æ–¥ —Å–º–µ—Ä–∂–µ–Ω –≤ master
